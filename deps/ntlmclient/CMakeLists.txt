add_library(ntlmclient OBJECT ntlm.c unicode_builtin.c util.c)
target_compile_definitions(ntlmclient PRIVATE NTLM_STATIC=1)

if(USE_HTTPS STREQUAL "SecureTransport")
	target_compile_definitions(ntlmclient PRIVATE -DCRYPT_COMMONCRYPTO)
	target_sources(ntlmclient PRIVATE crypt_commoncrypto.c)
	# CC_MD4 has been deprecated in macOS 10.15.
	set_source_files_properties(crypt_commoncrypto.c COMPILE_FLAGS -Wno-deprecated)
elseif(USE_HTTPS STREQUAL "OpenSSL")
	target_compile_definitions(ntlmclient PRIVATE CRYPT_OPENSSL)
	target_include_directories(ntlmclient PRIVATE ${OPENSSL_INCLUDE_DIR})
	target_sources(ntlmclient PRIVATE crypt_openssl.c)
elseif(USE_HTTPS STREQUAL "mbedTLS")
	target_compile_definitions(ntlmclient PRIVATE CRYPT_MBEDTLS)
	target_sources(ntlmclient PRIVATE crypt_mbedtls.c)
else()
	MESSAGE(FATAL_ERROR "Unable to use libgit2's HTTPS backend (${USE_HTTPS}) for NTLM crypto")
endif()

target_disable_warning(ntlmclient implicit-fallthrough)
